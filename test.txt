// Preview and predict the image when it is selected
function previewAndPredictImage(event) {
    const file = event.target.files[0];
    if (file) {
        // Call the predictImage function directly with the file
        predictImage(file);
    }
}

// Predict the image using Roboflow API with form data
function predictImage(file) {
    const apiKey = "7teFJo3CW2Pvjy7IsQgL";
    const modelUrl = "https://detect.roboflow.com/ingredient-detector-fc7de/1";

    // Create a FormData object and append the file
    let formData = new FormData();
    formData.append('api_key', apiKey);
    formData.append('image', file);

    console.log(formData);

    // Send the request with the file using Axios
    axios({
        method: "POST",
        url: "https://detect.roboflow.com/ingredient-detector-fc7de/1",
        params: {
            api_key: "7teFJo3CW2Pvjy7IsQgL",
            image: "https://i.imgur.com/PEEvqPN.png"
        }
    })
    .then(function(response) {
        console.log(response.data);
        updateIngredients(response.data);
    })
    .catch(function(error) {
        console.error(error);
        document.querySelector('.ingredietns').textContent = 'Error: ' + error.message;
    });
}

// Display results and update the UI
function updateIngredients(data) {
    const ingredientsList = document.querySelector('.ingredietns');
    const existingIngredients = JSON.parse(localStorage.getItem('ings_string') || '[]');

    data.predictions.forEach(prediction => {
        if (!existingIngredients.includes(prediction.class)) {
            existingIngredients.push(prediction.class);
            const ingredientElement = document.createElement('div');
            ingredientElement.className = 'ing';
            ingredientElement.textContent = prediction.class;
            ingredientsList.appendChild(ingredientElement);
        }
    });

    // Update local storage with new ingredients list
    localStorage.setItem('ings_string', JSON.stringify(existingIngredients));
}

// Function to clear the image input and ingredients list
function clearImage() {
    document.querySelector('.ingredietns').innerHTML = '';
    localStorage.removeItem('ings_string');
}